"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[572],{4572:(ft,T,s)=>{s.r(T),s.d(T,{ProductModule:()=>dt});var m=s(6814),v=s(3557),h=s(5219),g=s(9862),p=s(95),_=s(1486),t=s(4769),D=s(981),N=s(5905),J=s(8814),C=s(9552),b=s(707),A=s(3714),P=s(4480),y=s(3965),Z=s(4104),w=s(1312),Y=s(6340),M=s(3904),S=s(6760),U=s(8981);const F=["dt"];function k(e,r){if(1&e&&(t.TgZ(0,"div",22)(1,"div",23)(2,"span",24),t._uU(3),t.qZA()()()),2&e){const o=r.$implicit;t.xp6(3),t.Oqu(o.header)}}const Q=function(){return{height:"30rem"}};function B(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"div",16)(1,"div",17)(2,"h4"),t._uU(3,"Select Columns for Creating Table"),t.qZA(),t.TgZ(4,"p-pickList",18),t.YNc(5,k,4,1,"ng-template",19),t.qZA(),t.TgZ(6,"div",20)(7,"button",21),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.openNew())}),t.qZA()()()()}if(2&e){const o=t.oxw();t.xp6(4),t.Q6J("source",o.sourceProducts)("target",o.targetProducts)("dragdrop",!0)("responsive",!0)("sourceStyle",t.DdM(5,Q))}}function H(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(o),t.oxw();const n=t.MAs(6);return t.KtG(n.exportCSV())}),t.qZA(),t._uU(1,"\xa0\xa0\xa0\xa0\xa0\xa0 "),t.TgZ(2,"button",26),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.showDragandDrop=!n.showDragandDrop)}),t.qZA(),t._uU(3,"\xa0\xa0\xa0\xa0\xa0\xa0 "),t.TgZ(4,"button",27),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.productDialog=!0)}),t.qZA(),t._uU(5,"\xa0\xa0\xa0\xa0\xa0\xa0 ")}}function R(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"div",28)(1,"h5",29),t._uU(2,"Device Details"),t.qZA(),t.TgZ(3,"span",30),t._UZ(4,"i",31),t.TgZ(5,"input",32),t.NdJ("input",function(n){t.CHM(o);const l=t.oxw();return t.KtG(l.filterGlobal_secondary(n))}),t.qZA()()()}}function z(e,r){if(1&e&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&e){const o=r.$implicit;t.Udp("width",null==o?null:o.width),t.xp6(1),t.hij(" ",o.header," ")}}function E(e,r){if(1&e&&(t.TgZ(0,"tr")(1,"th",33),t._uU(2,"Sl No."),t.qZA(),t.YNc(3,z,2,3,"th",34),t.qZA()),2&e){const o=t.oxw();t.xp6(3),t.Q6J("ngForOf",o.cols)}}function G(e,r){if(1&e&&(t.ynx(0),t._uU(1),t.ALo(2,"date"),t.BQk()),2&e){const o=t.oxw(2).$implicit,i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i[o.field]?t.xi3(2,1,i[o.field],"dd-MM-YYYY"):0," ")}}function O(e,r){if(1&e&&(t.ynx(0),t._uU(1),t.BQk()),2&e){const o=t.oxw(2).$implicit,i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i[o.field]?i[o.field]:0," ")}}function $(e,r){if(1&e&&(t.TgZ(0,"td"),t.ynx(1,37),t.YNc(2,G,3,4,"ng-container",38),t.YNc(3,O,2,1,"ng-container",39),t.BQk(),t.qZA()),2&e){const o=t.oxw().$implicit;t.Udp("width",null==o?null:o.width),t.xp6(1),t.Q6J("ngSwitch",!0),t.xp6(1),t.Q6J("ngSwitchCase","date"===o.field)}}function j(e,r){if(1&e&&(t.ynx(0),t.YNc(1,$,4,4,"td",36),t.BQk()),2&e){const o=r.$implicit;t.xp6(1),t.Q6J("ngIf",o.field)}}function q(e,r){if(1&e&&(t.TgZ(0,"tr")(1,"td",33),t._uU(2),t.qZA(),t.YNc(3,j,2,1,"ng-container",35),t.qZA()),2&e){const o=r.rowIndex,i=t.oxw();t.xp6(2),t.Oqu(o+1),t.xp6(1),t.Q6J("ngForOf",i.cols)}}function K(e,r){if(1&e&&(t.TgZ(0,"tr",40)(1,"td",41),t._uU(2,"No device available."),t.qZA()()),2&e){const o=t.oxw();t.xp6(1),t.uIk("colspan",o.cols.length+1)}}function L(e,r){if(1&e&&(t.TgZ(0,"div",28),t._uU(1),t.qZA()),2&e){const o=t.oxw();t.xp6(1),t.hij("In total there are ",o.products?o.products.length:0," device data.")}}function W(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"form",42)(1,"div",43)(2,"label",44),t._uU(3," Device "),t.qZA(),t.TgZ(4,"p-dropdown",45),t.NdJ("ngModelChange",function(n){t.CHM(o);const l=t.oxw();return t.KtG(l.selectedDevice=n)}),t.qZA()(),t.TgZ(5,"div",46)(6,"label",47),t._uU(7," From Date "),t.qZA(),t._UZ(8,"p-calendar",48),t.qZA(),t.TgZ(9,"div",49)(10,"label",50),t._uU(11," To Date "),t.qZA(),t._UZ(12,"p-calendar",51),t.qZA()()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.reportData),t.xp6(4),t.Q6J("options",o.cities)("ngModel",o.selectedDevice)("appendTo","body")("showClear",!0),t.xp6(4),t.Q6J("appendTo","body")("showIcon",!0),t.xp6(4),t.Q6J("appendTo","body")("showIcon",!0)}}function V(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"button",52),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.saveProduct())}),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("disabled",!o.reportData.valid)}}function X(e,r){1&e&&(t.TgZ(0,"div",53),t._UZ(1,"div")(2,"div")(3,"div")(4,"div")(5,"div"),t.qZA())}function tt(e,r){1&e&&t._UZ(0,"div",54)}const I=function(){return{width:"450px"}};let et=(()=>{var e;class r{constructor(i,n,l,d,c,a,u,f,pt,ut,mt,ht){this.router=i,this.carService=n,this.cdr=l,this.authservice=d,this.filterService=c,this.fb=a,this.http=u,this.productService=f,this.messageService=pt,this.datePipe=ut,this.confirmationService=mt,this.api=ht,this.productDialog=!1,this.product=null,this.submitted=!1,this.client_id=+localStorage.getItem("c_id"),this.data1=[],this.data2=[],this.fromDate="",this.toDate="",this.device="",this.spinner=!1,this.fastLoading=0,this.cols=[],this.excelData=[],this.r=!1,this.y=!1,this.b=!1,this.r_y=!1,this.y_b=!1,this.b_r=!1,this.curr1=!1,this.curr2=!1,this.curr3=!1,this.eng=!1,this.pf=!1,this.freq=!1,this.runhr=!1,this.totkw=!1,this.totkva=!1,this.totkvar=!1,this.filterGlobal_secondary=x=>{this.primeTable.filterGlobal(x.target.value,"contains")},this.getColumns=()=>this.cols.map(x=>x.field)}ngOnInit(){this.showDragandDrop=!1,this.cols=[{field:"date",header:"Date",width:"6rem"},{field:"time",header:"Time"},{field:"device",header:"Device Name"}],this.sourceProducts=[{field:"zone1",header:"Zone 1",width:"5rem"},{field:"zone2",header:"Zone 2",width:"5rem"},{field:"main",header:"Main",width:"5rem"},{field:"battery",header:"Battery",width:"5rem"}],this.targetProducts=[{field:"date",header:"Date",width:"6rem"},{field:"time",header:"Time"},{field:"device",header:"Device Name"}],this.user_type=localStorage.getItem("u_type"),this.reportData=this.fb.group({d_id:["",p.kI.required],fdate:["",p.kI.required],tdate:["",[p.kI.required]]}),this.product={},this.submitted=!1,this.productDialog=!0,this.getDeviceDATA()}convertToISTDateTime(i){const n=new Date(i);return this.datePipe.transform(n,"HH:mm:ss","+0530")||""}getDeviceDATA(){const i=this.api.baseUrl,n=localStorage.getItem("token"),l=(new g.WM).set("Authorization",`Bearer ${n}`);this.http.post(i+"/client/devices/list",{client_id:this.client_id},{headers:l}).subscribe(c=>{console.log(c),this.data2=c,this.cities=this.data2.data},c=>{"401"==c.status&&this.router.navigate(["/"]),console.log(c.status),console.error(c)})}openNew(){this.cols=[],this.showDragandDrop=!1,this.cols=this.targetProducts,console.log(this.targetProducts)}deleteSelectedProducts(){this.confirmationService.confirm({message:"Are you sure you want to delete the selected products?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{this.products=this.products.filter(i=>!this.selectedProducts?.includes(i)),this.selectedProducts=null,this.messageService.add({severity:"success",summary:"Successful",detail:"Products Deleted",life:3e3})}})}editProduct(i){this.product={...i},this.productDialog=!0}deleteProduct(i){this.confirmationService.confirm({message:"Are you sure you want to delete "+i.user_name+"?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{this.DeleteCompany(i.user_id)}})}hideDialog(){this.productDialog=!1,this.submitted=!1}saveProduct(){this.fromDate="",this.toDate="",this.device="",this.submitted=!0,this.device=this.reportData.controls.d_id.value.device,this.fromDate=this.datePipe.transform(this.reportData.controls.fdate.value,"YYYY-MM-dd"),this.toDate=this.datePipe.transform(this.reportData.controls.tdate.value,"YYYY-MM-dd");const i={client_id:this.client_id,start_date:this.datePipe.transform(this.reportData.controls.fdate.value,"YYYY-MM-dd"),end_date:this.datePipe.transform(this.reportData.controls.tdate.value,"YYYY-MM-dd"),device:this.device,device_id:this.reportData.controls.d_id.value.device_id};this.spinner=!0;const n=this.api.baseUrl,l=localStorage.getItem("token"),d=(new g.WM).set("Authorization",`Bearer ${l}`);this.productDialog=!1,this.http.post(n+"/client/report/firealarm_data",i,{headers:d}).subscribe(c=>{this.spinner=!1,console.log(c),this.data1=c,this.products=this.data1.data,this.excelData=this.data1.data,this.products.forEach(a=>{a.time=this.convertToISTDateTime(a.created_at);const f=a.digital_Input.padStart(4,"0");a.zone1=f.charAt(0),a.zone2=f.charAt(1),a.main=f.charAt(3),a.battery=f.charAt(4)}),this.products=[...this.products],this.product={},this.showDragandDrop=!0},c=>{this.spinner=!1,"401"==c.status&&this.router.navigate(["/"]),console.log(c.status),console.error(c)})}updateCompany(i,n){const l={product_id:i,product_name:n},d=this.api.baseUrl,c=localStorage.getItem("token"),a=(new g.WM).set("Authorization",`Bearer ${c}`);this.http.post(d+"/master/edit_product_name",l,{headers:a}).subscribe(u=>{console.log(u),this.messageService.add({severity:"success",summary:"Successful",detail:"Company Updated",life:3e3}),this.getDeviceDATA()},u=>{"401"==u.status&&this.router.navigate(["/"]),console.log(u.status),console.error(u)})}AddCompany(i){const n={product_name:i},l=this.api.baseUrl,d=localStorage.getItem("token"),c=(new g.WM).set("Authorization",`Bearer ${d}`);this.http.post(l+"/master/add_product_name",n,{headers:c}).subscribe(a=>{console.log(a),this.messageService.add({severity:"success",summary:"Successful",detail:"Company Created",life:3e3}),this.getDeviceDATA()},a=>{"401"==a.status&&this.router.navigate(["/"]),console.log(a.status),console.error(a)})}DeleteCompany(i){const n={product_id:i},l=this.api.baseUrl,d=localStorage.getItem("token"),c=(new g.WM).set("Authorization",`Bearer ${d}`);this.http.post(l+"/master/delete_product_name",n,{headers:c}).subscribe(a=>{console.log(a),this.messageService.add({severity:"success",summary:"Successful",detail:"Company Deleted",life:3e3}),this.getDeviceDATA()},a=>{"401"==a.status&&this.router.navigate(["/"]),console.log(a.status),console.error(a)})}exportToExcel(){const i=[],n=[];this.cols.forEach(a=>{n.push(a.col)}),i.push(["Sl No.","DATE","TIME","HUMIDITY (%)","TEMPERATURE (%)"]);for(let a=0;a<this.excelData.length;a++)i.push([a+1,this.excelData[a].date,this.excelData[a].time,this.excelData[a].device_name,this.excelData[a].temperature,this.excelData[a].humidity]);const d=_.P6.aoa_to_sheet(i),c=_.P6.book_new();_.P6.book_append_sheet(c,d,"Sheet1"),_.NC(c,"Report_data.xlsx")}}return(e=r).\u0275fac=function(i){return new(i||e)(t.Y36(v.F0),t.Y36(D.M),t.Y36(t.sBO),t.Y36(N.$),t.Y36(h.iZ),t.Y36(p.qu),t.Y36(g.eN),t.Y36(D.M),t.Y36(h.ez),t.Y36(m.uU),t.Y36(h.YP),t.Y36(J.s))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-product"]],viewQuery:function(i,n){if(1&i&&t.Gf(F,5),2&i){let l;t.iGM(l=t.CRH())&&(n.primeTable=l.first)}},features:[t._Bn([h.ez,h.YP,m.uU])],decls:18,vars:20,consts:[[1,"card"],["class","col-12 ",4,"ngIf"],["styleClass","mb-4 gap-2"],["pTemplate","right"],["styleClass","p-datatable-gridlines","dataKey","product_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rows","columns","paginator","responsive","globalFilterFields","selection","rowHover","showCurrentPageReport","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],["header","Device Details","styleClass","p-fluid",3,"visible","modal","visibleChange"],["pTemplate","content"],["pTemplate","footer"],["class","loader",4,"ngIf"],["class","overlay",4,"ngIf"],[1,"col-12"],[2,"position","relative","padding-bottom","inherit","text-align","center"],["sourceHeader","Available Columns","targetHeader","Selected",3,"source","target","dragdrop","responsive","sourceStyle"],["pTemplate","item"],[2,"margin-top","30px","text-align","center"],["pButton","","pRipple","","label","Get Table","icon","pi pi-angle-double-down",1,"p-button-primary",3,"click"],[1,"flex","flex-wrap","p-2","align-items-center","gap-3"],[1,"flex-1","flex","flex-column","gap-2"],[1,"font-bold"],["pButton","","pRipple","","label","Export to excel","icon","pi pi-upload",1,"p-button-primary",3,"click"],["pButton","","pRipple","","label","Change Column","icon","pi pi-spin pi-cog",1,"p-button-danger",3,"click"],["pButton","","pRipple","","label","Retrive","icon","pi pi-angle-double-down",1,"p-button-help",3,"click"],[1,"flex","align-items-center","justify-content-between"],[1,"m-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...",3,"input"],[2,"width","2rem"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width",4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"noDataFound"],[1,"text-center"],[2,"width","100%",3,"formGroup"],[1,"flex-auto","mt-3"],["for","Device",1,"font-semibold","block","mb-2"],["formControlName","d_id","optionLabel","device","inputId","Device","placeholder","Select a Device",3,"options","ngModel","appendTo","showClear","ngModelChange"],[1,"flex-auto","my-3"],["for","fdate",1,"font-semibold","block","mb-2"],["formControlName","fdate","placeholder","DD-MM-YYYY","dateFormat","dd-mm-yy","inputId","fdate",3,"appendTo","showIcon"],[1,"flex-auto"],["for","tdate",1,"font-semibold","block","mb-2"],["formControlName","tdate","placeholder","DD-MM-YYYY","dateFormat","dd-mm-yy","inputId","tdate",3,"appendTo","showIcon"],["pButton","","pRipple","","label","Submit","icon","pi pi-check",1,"p-button-text",3,"disabled","click"],[1,"loader"],[1,"overlay"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0),t.YNc(1,B,8,6,"div",1),t._UZ(2,"p-toast"),t.TgZ(3,"p-toolbar",2),t.YNc(4,H,6,0,"ng-template",3),t.qZA(),t.TgZ(5,"p-table",4,5),t.NdJ("selectionChange",function(d){return n.selectedProducts=d}),t.YNc(7,R,6,0,"ng-template",6),t.YNc(8,E,4,1,"ng-template",7),t.YNc(9,q,4,2,"ng-template",8),t.YNc(10,K,3,1,"ng-template",9),t.YNc(11,L,2,1,"ng-template",10),t.qZA()(),t.TgZ(12,"p-dialog",11),t.NdJ("visibleChange",function(d){return n.productDialog=d}),t.YNc(13,W,13,9,"ng-template",12),t.YNc(14,V,1,1,"ng-template",13),t.qZA(),t._UZ(15,"p-confirmDialog"),t.YNc(16,X,6,0,"div",14),t.YNc(17,tt,1,0,"div",15)),2&i&&(t.xp6(1),t.Q6J("ngIf",n.showDragandDrop),t.xp6(4),t.Q6J("value",n.products)("rows",20)("columns",n.cols)("paginator",!0)("responsive",!0)("globalFilterFields",n.getColumns())("selection",n.selectedProducts)("rowHover",!0)("showCurrentPageReport",!0),t.xp6(7),t.Akn(t.DdM(18,I)),t.Q6J("visible",n.productDialog)("modal",!0),t.xp6(3),t.Akn(t.DdM(19,I)),t.xp6(1),t.Q6J("ngIf",n.spinner),t.xp6(1),t.Q6J("ngIf",n.spinner))},dependencies:[m.sg,m.O5,m.RF,m.n9,m.ED,p._Y,p.JJ,p.JL,p.sg,p.u,C.iA,h.jx,b.Hq,A.o,P.H,y.Lt,Z.FN,w.V,Y.o,M.Q,S.f,U.G,m.uU],styles:[".datefield[_ngcontent-%COMP%]{width:100%;height:40px;border-radius:7px;border:1px solid #d3cece}tr.noDataFound[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:13px;text-transform:uppercase;font-weight:500}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:9px 2px!important;font-size:10px!important}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{padding:6px!important;font-weight:500!important;font-size:12px!important}[_nghost-%COMP%]     .p-datatable .p-datatable-header{padding:7px!important;font-weight:600;background:#fff!important}"]}),r})(),ot=(()=>{var e;class r{}return(e=r).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[v.Bz.forChild([{path:"",component:et}]),v.Bz]}),r})();var it=s(6804),nt=s(4055),at=s(6651),st=s(7902),rt=s(6022),ct=s(7680),lt=s(9246);let dt=(()=>{var e;class r{}return(e=r).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[h.iZ],imports:[m.ez,p.UX,p.u5,C.U$,rt.Xt,b.hJ,st.JH,A.j,it.KZ,P.T,nt.q4,y.kW,at.q,Z.EV,w.S,Y.V,lt.l,ct.L,M.D,S._8,ot,U.f]}),r})()}}]);