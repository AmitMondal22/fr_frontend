"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[572],{4572:(Zt,T,r)=>{r.r(T),r.d(T,{ProductModule:()=>mt});var g=r(6814),_=r(3557),u=r(5219),h=r(9862),d=r(95),f=r(1486),t=r(4769),Z=r(981),I=r(5905),N=r(8814),D=r(9552),x=r(707),A=r(3714),C=r(4480),b=r(3965),P=r(4104),U=r(1312),y=r(6340),S=r(3904),Y=r(6760);const M=["dt"];function w(o,s){if(1&o){const l=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(l);const a=t.oxw();return t.KtG(a.exportToExcel())}),t.qZA(),t._uU(1,"\xa0\xa0\xa0\xa0\xa0\xa0 "),t.TgZ(2,"button",16),t.NdJ("click",function(){t.CHM(l);const a=t.oxw();return t.KtG(a.productDialog=!0)}),t.qZA(),t._uU(3,"\xa0\xa0\xa0\xa0\xa0\xa0 ")}}function J(o,s){if(1&o){const l=t.EpF();t.TgZ(0,"div",17)(1,"h5",18),t._uU(2,"Device Details"),t.qZA(),t.TgZ(3,"span",19),t._UZ(4,"i",20),t.TgZ(5,"input",21),t.NdJ("input",function(a){t.CHM(l);const n=t.oxw();return t.KtG(n.filterGlobal_secondary(a))}),t.qZA()()()}}function F(o,s){1&o&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Fire Data ID"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Device"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Date"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Time"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Zone 1 Status"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Zone 2 Status"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Main Status"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Battery"),t.qZA()())}function q(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Fire"),t.qZA())}function Q(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Short"),t.qZA())}function B(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Open"),t.qZA())}function O(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Normal"),t.qZA())}function k(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"No Status"),t.qZA())}function H(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Fire"),t.qZA())}function G(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Short"),t.qZA())}function R(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Open"),t.qZA())}function $(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Normal"),t.qZA())}function E(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"No Status"),t.qZA())}function j(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Normal"),t.qZA())}function K(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Critical"),t.qZA())}function L(o,s){if(1&o&&(t.TgZ(0,"tr")(1,"td",22),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t.YNc(11,q,2,0,"span",23),t.YNc(12,Q,2,0,"span",23),t.YNc(13,B,2,0,"span",23),t.YNc(14,O,2,0,"span",23),t.YNc(15,k,2,0,"span",23),t.qZA(),t.TgZ(16,"td"),t.YNc(17,H,2,0,"span",23),t.YNc(18,G,2,0,"span",23),t.YNc(19,R,2,0,"span",23),t.YNc(20,$,2,0,"span",23),t.YNc(21,E,2,0,"span",23),t.qZA(),t.TgZ(22,"td"),t.YNc(23,j,2,0,"span",23),t.YNc(24,K,2,0,"span",23),t.qZA(),t.TgZ(25,"td"),t._uU(26),t.qZA()()),2&o){const l=s.rowIndex,e=s.$implicit;t.xp6(2),t.Oqu(l+1),t.xp6(2),t.Oqu(t.xi3(5,17,e.date,"dd-MM-YYYY")),t.xp6(3),t.Oqu(e.time),t.xp6(2),t.Oqu(e.device),t.xp6(2),t.Q6J("ngIf","1"==e.Firez1),t.xp6(1),t.Q6J("ngIf","1"==e.shortz1),t.xp6(1),t.Q6J("ngIf","1"==e.openz1),t.xp6(1),t.Q6J("ngIf","1"==e.normalz1),t.xp6(1),t.Q6J("ngIf","0"==e.normalz1&&"0"==e.shortz1&&"0"==e.openz1&&"0"==e.Firez1),t.xp6(2),t.Q6J("ngIf","1"==e.Firez2),t.xp6(1),t.Q6J("ngIf","1"==e.shortz2),t.xp6(1),t.Q6J("ngIf","1"==e.openz2),t.xp6(1),t.Q6J("ngIf","1"==e.normalz2),t.xp6(1),t.Q6J("ngIf","0"==e.normalz2&&"0"==e.shortz2&&"0"==e.openz2&&"0"==e.Firez2),t.xp6(2),t.Q6J("ngIf","0"==e.power),t.xp6(1),t.Q6J("ngIf","1"==e.power),t.xp6(2),t.hij("",e.batteryv/100," V")}}function W(o,s){1&o&&(t.TgZ(0,"tr",24)(1,"td",25),t._uU(2,"No device available."),t.qZA()())}function V(o,s){if(1&o&&(t.TgZ(0,"div",17),t._uU(1),t.qZA()),2&o){const l=t.oxw();t.xp6(1),t.hij("In total there are ",l.products?l.products.length:0," device data.")}}function X(o,s){if(1&o){const l=t.EpF();t.TgZ(0,"form",26)(1,"div",27)(2,"label",28),t._uU(3," Device "),t.qZA(),t.TgZ(4,"p-dropdown",29),t.NdJ("ngModelChange",function(a){t.CHM(l);const n=t.oxw();return t.KtG(n.selectedDevice=a)}),t.qZA()(),t.TgZ(5,"div",30)(6,"label",31),t._uU(7," From Date "),t.qZA(),t._UZ(8,"p-calendar",32),t.qZA(),t.TgZ(9,"div",33)(10,"label",34),t._uU(11," To Date "),t.qZA(),t._UZ(12,"p-calendar",35),t.qZA()()}if(2&o){const l=t.oxw();t.Q6J("formGroup",l.reportData),t.xp6(4),t.Q6J("options",l.cities)("ngModel",l.selectedDevice)("appendTo","body")("showClear",!0),t.xp6(4),t.Q6J("appendTo","body")("showIcon",!0),t.xp6(4),t.Q6J("appendTo","body")("showIcon",!0)}}function tt(o,s){if(1&o){const l=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(){t.CHM(l);const a=t.oxw();return t.KtG(a.saveProduct())}),t.qZA()}if(2&o){const l=t.oxw();t.Q6J("disabled",!l.reportData.valid)}}function et(o,s){1&o&&(t.TgZ(0,"div",37),t._UZ(1,"div")(2,"div")(3,"div")(4,"div")(5,"div"),t.qZA())}function ot(o,s){1&o&&t._UZ(0,"div",38)}const z=function(){return{width:"450px"}};let at=(()=>{var o;class s{constructor(e,a,n,i,c,p,m,ht,gt,ft,_t,vt){this.router=e,this.carService=a,this.cdr=n,this.authservice=i,this.filterService=c,this.fb=p,this.http=m,this.productService=ht,this.messageService=gt,this.datePipe=ft,this.confirmationService=_t,this.api=vt,this.productDialog=!1,this.product=null,this.submitted=!1,this.client_id=+localStorage.getItem("c_id"),this.data1=[],this.data2=[],this.fromDate="",this.toDate="",this.device="",this.spinner=!1,this.fastLoading=0,this.cols=[],this.excelData=[],this.r=!1,this.y=!1,this.b=!1,this.r_y=!1,this.y_b=!1,this.b_r=!1,this.curr1=!1,this.curr2=!1,this.curr3=!1,this.eng=!1,this.pf=!1,this.freq=!1,this.runhr=!1,this.totkw=!1,this.totkva=!1,this.totkvar=!1,this.filterGlobal_secondary=v=>{this.primeTable.filterGlobal(v.target.value,"contains")},this.getColumns=()=>this.cols.map(v=>v.field)}ngOnInit(){this.showDragandDrop=!1,this.cols=[{field:"date",header:"Date",width:"6rem"},{field:"time",header:"Time"},{field:"device",header:"Device Name"}],this.sourceProducts=[{field:"zone1",header:"Zone 1",width:"5rem"},{field:"zone2",header:"Zone 2",width:"5rem"},{field:"main",header:"Main",width:"5rem"},{field:"battery",header:"Battery",width:"5rem"}],this.targetProducts=[{field:"date",header:"Date",width:"6rem"},{field:"time",header:"Time"},{field:"device",header:"Device Name"}],this.user_type=localStorage.getItem("u_type"),this.reportData=this.fb.group({d_id:["",d.kI.required],fdate:["",d.kI.required],tdate:["",[d.kI.required]]}),this.product={},this.submitted=!1,this.productDialog=!0,this.getDeviceDATA()}convertToISTDateTime(e){const a=new Date(e);return this.datePipe.transform(a,"HH:mm:ss","+0530")||""}getDeviceDATA(){const e=this.api.baseUrl,a=localStorage.getItem("token"),n=(new h.WM).set("Authorization",`Bearer ${a}`);this.http.post(e+"/client/devices/list",{client_id:this.client_id},{headers:n}).subscribe(c=>{console.log(c),this.data2=c,this.cities=this.data2.data},c=>{"401"==c.status&&this.router.navigate(["/"]),console.log(c.status),console.error(c)})}openNew(){this.cols=[],this.showDragandDrop=!1,this.cols=this.targetProducts,console.log(this.targetProducts)}deleteSelectedProducts(){this.confirmationService.confirm({message:"Are you sure you want to delete the selected products?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{this.products=this.products.filter(e=>!this.selectedProducts?.includes(e)),this.selectedProducts=null,this.messageService.add({severity:"success",summary:"Successful",detail:"Products Deleted",life:3e3})}})}editProduct(e){this.product={...e},this.productDialog=!0}deleteProduct(e){this.confirmationService.confirm({message:"Are you sure you want to delete "+e.user_name+"?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{this.DeleteCompany(e.user_id)}})}hideDialog(){this.productDialog=!1,this.submitted=!1}formatDate(e){const a=new Date(e),p=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return console.log(p),p}saveProduct(){this.fromDate="",this.toDate="",this.device="",this.submitted=!0,this.device=this.reportData.controls.d_id.value.device,this.fromDate=this.formatDate(this.reportData.controls.fdate.value),this.toDate=this.formatDate(this.reportData.controls.tdate.value);const e={client_id:this.client_id,start_date:this.formatDate(this.reportData.controls.fdate.value),end_date:this.formatDate(this.reportData.controls.tdate.value),device:this.device,device_id:this.reportData.controls.d_id.value.device_id};this.spinner=!0;const a=this.api.baseUrl,n=localStorage.getItem("token"),i=(new h.WM).set("Authorization",`Bearer ${n}`);this.productDialog=!1,this.http.post(a+"/client/report/firealarm_data",e,{headers:i}).subscribe(c=>{this.spinner=!1,console.log(c),this.data1=c,this.products=this.data1.data,this.products.forEach(p=>{this.parseDigitalInput(p)}),this.excelData=this.data1.data,this.products=[...this.products],this.product={},this.showDragandDrop=!0},c=>{this.spinner=!1,"401"==c.status&&this.router.navigate(["/"]),console.log(c.status),console.error(c)})}parseDigitalInput(e){const n=e.digital_Input.toString().padStart(11,"0"),i=n.split(",").map(c=>c.trim());e.Firez1=n.charAt(0),e.Firez2=n.charAt(3),e.openz1=n.charAt(6),e.openz2=n.charAt(9),e.shortz1=n.charAt(12),e.shortz2=n.charAt(15),e.normalz1=n.charAt(18),e.normalz2=n.charAt(21),e.power=n.charAt(24),e.batteryv=i[9],e.silence=n.charAt(33)}exportToExcel(){const e=this.excelData.map(i=>({Device:i.device,Date:i.date,Time:i.time,"Zone 1 Status":this.getZoneStatus(i.Firez1,i.shortz1,i.openz1,i.normalz1),"Zone 2 Status":this.getZoneStatus(i.Firez2,i.shortz2,i.openz2,i.normalz2),"Main Status":"0"===i.power?"Normal":"Critical",Battery:i.batteryv/100+" V"})),a=f.P6.json_to_sheet(e),n=f.P6.book_new();f.P6.book_append_sheet(n,a,"Fire Data"),f.NC(n,"fire_data.xlsx")}getZoneStatus(e,a,n,i){return"1"===e?"Fire":"1"===a?"Short":"1"===n?"Open":"1"===i?"Normal":"No Status"}updateCompany(e,a){const n={product_id:e,product_name:a},i=this.api.baseUrl,c=localStorage.getItem("token"),p=(new h.WM).set("Authorization",`Bearer ${c}`);this.http.post(i+"/master/edit_product_name",n,{headers:p}).subscribe(m=>{console.log(m),this.messageService.add({severity:"success",summary:"Successful",detail:"Company Updated",life:3e3}),this.getDeviceDATA()},m=>{"401"==m.status&&this.router.navigate(["/"]),console.log(m.status),console.error(m)})}AddCompany(e){const a={product_name:e},n=this.api.baseUrl,i=localStorage.getItem("token"),c=(new h.WM).set("Authorization",`Bearer ${i}`);this.http.post(n+"/master/add_product_name",a,{headers:c}).subscribe(p=>{console.log(p),this.messageService.add({severity:"success",summary:"Successful",detail:"Company Created",life:3e3}),this.getDeviceDATA()},p=>{"401"==p.status&&this.router.navigate(["/"]),console.log(p.status),console.error(p)})}DeleteCompany(e){const a={product_id:e},n=this.api.baseUrl,i=localStorage.getItem("token"),c=(new h.WM).set("Authorization",`Bearer ${i}`);this.http.post(n+"/master/delete_product_name",a,{headers:c}).subscribe(p=>{console.log(p),this.messageService.add({severity:"success",summary:"Successful",detail:"Company Deleted",life:3e3}),this.getDeviceDATA()},p=>{"401"==p.status&&this.router.navigate(["/"]),console.log(p.status),console.error(p)})}}return(o=s).\u0275fac=function(e){return new(e||o)(t.Y36(_.F0),t.Y36(Z.M),t.Y36(t.sBO),t.Y36(I.$),t.Y36(u.iZ),t.Y36(d.qu),t.Y36(h.eN),t.Y36(Z.M),t.Y36(u.ez),t.Y36(g.uU),t.Y36(u.YP),t.Y36(N.s))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-product"]],viewQuery:function(e,a){if(1&e&&t.Gf(M,5),2&e){let n;t.iGM(n=t.CRH())&&(a.primeTable=n.first)}},features:[t._Bn([u.ez,u.YP,g.uU])],decls:17,vars:19,consts:[[1,"card"],["styleClass","mb-4 gap-2"],["pTemplate","right"],["styleClass","p-datatable-gridlines","dataKey","product_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rows","columns","paginator","responsive","globalFilterFields","selection","rowHover","showCurrentPageReport","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],["header","Device Details","styleClass","p-fluid",3,"visible","modal","visibleChange"],["pTemplate","content"],["pTemplate","footer"],["class","loader",4,"ngIf"],["class","overlay",4,"ngIf"],["pButton","","pRipple","","label","Export to excel","icon","pi pi-upload",1,"p-button-primary",3,"click"],["pButton","","pRipple","","label","Retrive","icon","pi pi-angle-double-down",1,"p-button-help",3,"click"],[1,"flex","align-items-center","justify-content-between"],[1,"m-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...",3,"input"],[2,"width","2rem"],[4,"ngIf"],[1,"noDataFound"],["colspan","8",1,"text-center"],[2,"width","100%",3,"formGroup"],[1,"flex-auto","mt-3"],["for","Device",1,"font-semibold","block","mb-2"],["formControlName","d_id","optionLabel","device","inputId","Device","placeholder","Select a Device",3,"options","ngModel","appendTo","showClear","ngModelChange"],[1,"flex-auto","my-3"],["for","fdate",1,"font-semibold","block","mb-2"],["formControlName","fdate","placeholder","DD-MM-YYYY","dateFormat","dd-mm-yy","inputId","fdate",3,"appendTo","showIcon"],[1,"flex-auto"],["for","tdate",1,"font-semibold","block","mb-2"],["formControlName","tdate","placeholder","DD-MM-YYYY","dateFormat","dd-mm-yy","inputId","tdate",3,"appendTo","showIcon"],["pButton","","pRipple","","label","Submit","icon","pi pi-check",1,"p-button-text",3,"disabled","click"],[1,"loader"],[1,"overlay"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"p-toast"),t.TgZ(2,"p-toolbar",1),t.YNc(3,w,4,0,"ng-template",2),t.qZA(),t.TgZ(4,"p-table",3,4),t.NdJ("selectionChange",function(i){return a.selectedProducts=i}),t.YNc(6,J,6,0,"ng-template",5),t.YNc(7,F,17,0,"ng-template",6),t.YNc(8,L,27,20,"ng-template",7),t.YNc(9,W,3,0,"ng-template",8),t.YNc(10,V,2,1,"ng-template",9),t.qZA()(),t.TgZ(11,"p-dialog",10),t.NdJ("visibleChange",function(i){return a.productDialog=i}),t.YNc(12,X,13,9,"ng-template",11),t.YNc(13,tt,1,1,"ng-template",12),t.qZA(),t._UZ(14,"p-confirmDialog"),t.YNc(15,et,6,0,"div",13),t.YNc(16,ot,1,0,"div",14)),2&e&&(t.xp6(4),t.Q6J("value",a.products)("rows",20)("columns",a.cols)("paginator",!0)("responsive",!0)("globalFilterFields",a.getColumns())("selection",a.selectedProducts)("rowHover",!0)("showCurrentPageReport",!0),t.xp6(7),t.Akn(t.DdM(17,z)),t.Q6J("visible",a.productDialog)("modal",!0),t.xp6(3),t.Akn(t.DdM(18,z)),t.xp6(1),t.Q6J("ngIf",a.spinner),t.xp6(1),t.Q6J("ngIf",a.spinner))},dependencies:[g.O5,d._Y,d.JJ,d.JL,d.sg,d.u,D.iA,u.jx,x.Hq,A.o,C.H,b.Lt,P.FN,U.V,y.o,S.Q,Y.f,g.uU],styles:[".datefield[_ngcontent-%COMP%]{width:100%;height:40px;border-radius:7px;border:1px solid #d3cece}tr.noDataFound[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:13px;text-transform:uppercase;font-weight:500}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:9px 2px!important;font-size:10px!important}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{padding:6px!important;font-weight:500!important;font-size:12px!important}[_nghost-%COMP%]     .p-datatable .p-datatable-header{padding:7px!important;font-weight:600;background:#fff!important}"]}),s})(),nt=(()=>{var o;class s{}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[_.Bz.forChild([{path:"",component:at}]),_.Bz]}),s})();var it=r(6804),st=r(4055),rt=r(6651),lt=r(7902),ct=r(6022),pt=r(8981),dt=r(7680),ut=r(9246);let mt=(()=>{var o;class s{}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[u.iZ],imports:[g.ez,d.UX,d.u5,D.U$,ct.Xt,x.hJ,lt.JH,A.j,it.KZ,C.T,st.q4,b.kW,rt.q,P.EV,U.S,y.V,ut.l,dt.L,S.D,Y._8,nt,pt.f]}),s})()}}]);